<!DOCTYPE html>
<html
  data-wf-domain="elevate-7673d5.webflow.io"
  data-wf-page="65e71da996b7c2bba91db058"
  data-wf-site="65e71da996b7c2bba91db051"
  lang="en"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>Elevate</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Webflow" name="generator" />
    <link
      href="https://assets-global.website-files.com/65e71da996b7c2bba91db051/css/elevate-7673d5.webflow.b0c48b17e.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link
      href="https://fonts.gstatic.com"
      rel="preconnect"
      crossorigin="anonymous"
    />
    <script
      src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"
      type="text/javascript"
    ></script>
    <script type="text/javascript">
      WebFont.load({
        google: {
          families: [
            "Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic",
          ],
        },
      });
    </script>
    <script type="text/javascript">
      !(function (o, c) {
        var n = c.documentElement,
          t = " w-mod-";
        (n.className += t + "js"),
          ("ontouchstart" in o ||
            (o.DocumentTouch && c instanceof DocumentTouch)) &&
            (n.className += t + "touch");
      })(window, document);
    </script>
    <link
      href="https://assets-global.website-files.com/img/favicon.ico"
      rel="shortcut icon"
      type="image/x-icon"
    />
    <link
      href="https://assets-global.website-files.com/img/webclip.png"
      rel="apple-touch-icon"
    />

    <style>
      .analysis-card {
        margin-bottom: 20px; /* Space between cards */
      }

      .analysis-title {
        background-color: #f8f9fa; /* Light grey background for card header */
        border-bottom: 1px solid #e9ecef; /* Light border for separation */
        padding: 10px;
        border-radius: 0.25rem 0.25rem 0 0; /* Rounded top corners */
      }

      .analysis-body {
        padding: 15px; /* Padding inside the card */
      }

      container mb-5{
        margin-bottom: 30px;
      }
     
      
    </style>
  </head>
  <body>
    <div class="navbar-no-shadow">
      <div
        data-animation="default"
        data-collapse="medium"
        data-duration="400"
        data-easing="ease"
        data-easing2="ease"
        role="banner"
        class="navbar-no-shadow-container w-nav"
      >
        <div class="container-regular">
          <div class="navbar-wrapper">
            <img
              src="https://assets-global.website-files.com/65e71da996b7c2bba91db051/65e726f155ae114a0d626457_Screenshot%20(151)-Photoroom.png-Photoroom.png"
              loading="lazy"
              width="74"
              alt=""
              class="image"
            />
            <ul role="list" class="nav-menu w-list-unstyled">
              <li><a href="home" class="nav-link">Home</a></li>
              <li><a href="aboutus" class="nav-link">About Us</a></li>
              <li><a href="features" class="nav-link">Features</a></li>
            </ul>

            {% if current_user.is_authenticated %}
            <span class="nav-link">Hello, {{ current_user.username }}</span>
            <a href="login" class="button w-button" id="logout-link">Logout</a>
            {% else %}
            <a href="{{ url_for('login') }}" class="button-2 w-button">Login</a>
            <a href="{{ url_for('signup') }}" class="button w-button">Signup</a>
            {% endif %}

            <div class="menu-button w-nav-button">
              <div class="w-icon-nav-menu"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=65e71da996b7c2bba91db051"
      type="text/javascript"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>

    <div class="container my-5">
      <h1 class="display-4 mb-4 text-center">Analysis Summary</h1>
      
        <div class="card-body analysis-body">
          <p class="lead">{{ analysis|safe }}</p>
        
      </div>
    </div>
      
    <div class="container">
      <h2>Emotion Feedback</h2>
      {% if emotion_analysis %}

      <p>{{ emotion_analysis }}</p>
      {% endif %}
    </div>
    <div class="container">
      <canvas id="emotionChart"></canvas>
    </div>
    <div class="container">
      <h2>Posture Feedback</h2>
      {% if posture_analysis %}

      <p>{{ posture_analysis }}</p>
      {% endif %}
    </div>
    <div class="container">
      <canvas id="postureChart"></canvas>
    </div>
    <div class="container">
      {% if pose_analysis %}
      <h2>Pose Analysis Feedback</h2>
      <p>{{ pose_analysis }}</p>
      {% endif %}
    </div>
    <div class="container" style="width: 600px">
      <canvas id="poseChart"></canvas>
    </div>
    <div class="container">
      {% if blink_analysis %}
      <h2>Blink Analysis Feedback</h2>
      <p>{{ blink_analysis }}</p>
      {% endif %}
    </div>
    <div class="container">
      <canvas id="blinkChart"></canvas>
    </div>
    <div class="container mb-5"> <!-- Bootstrap margin-bottom class -->
        {% if speech_analysis %}
        <h2>Speech Feedback</h2>
        <p>{{ speech_analysis }}</p>
        {% endif %}
      </div>


      <div class="text-center">
        <button
        class="btn btn-primary mb-4" 
        type="button"
        data-toggle="collapse"
        data-target="#statisticsCollapse"
        aria-expanded="false"
        aria-controls="statisticsCollapse"
      >
        Show/Hide Statistics
      </button>
      
      <div class="collapse" id="statisticsCollapse">
        <div class="card card-body">
          <h3>Statistics</h3>
          <div id="statisticsSection">
            <h4>Emotions</h4>
            {% for emotion, duration in emotion_durations.items() %}
            <p>
              <strong>{{ emotion.title() }}:</strong> {{ duration }} seconds
            </p>
            {% endfor %}

            <h4>Postures</h4>
            {% for posture, duration in posture_durations.items() %}
            <p>
              <strong>{{ posture.title() }}:</strong> {{ duration }} seconds
            </p>
            {% endfor %}

            <h4>Poses</h4>
            {% for pose_data in aggregated_durations %}
            <p>
              <strong>{{ pose_data.pose.title() }}:</strong> {{
              pose_data.duration }} seconds
            </p>
            {% endfor %}

            <h4>Blink Data</h4>
            <p>Average Blinks Per Minute: {{ last_blink_average}}</p> 
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          // Emotion Chart
          var ctxEmotion = document.getElementById('emotionChart').getContext('2d');
          var emotionDurations = {{ emotion_durations | tojson }};
          console.log(emotionDurations);
          var emotionData = {
              labels: Object.keys(emotionDurations),
              datasets: [{
                  label: 'Emotion Duration (s)',
                  data: Object.values(emotionDurations),
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255, 99, 132, 1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
          };
          new Chart(ctxEmotion, {
              type: 'bar',
              data: emotionData,
              options: {
                  scales: {
                      y: {
                          beginAtZero: true
                      }
                  }
              }
          });

          // Posture Chart
          var ctxPosture = document.getElementById('postureChart').getContext('2d');
          var postureDurations = {{ posture_durations | tojson }};
          console.log(postureDurations);
          var postureData = {
              labels: Object.keys(postureDurations),
              datasets: [{
                  label: 'Posture Duration (s)',
                  data: Object.values(postureDurations),
                  backgroundColor: [
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)'
                  ],
                  borderWidth: 1
              }]
          };
          new Chart(ctxPosture, {
              type: 'bar',
              data: postureData,
              options: {
                  scales: {
                      y: {
                          beginAtZero: true
                      }
                  }
              }
          });
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          var aggregatedDurations = {{ aggregated_durations|map(attribute='duration')|list|tojson }};
          var poseLabels = {{ aggregated_durations|map(attribute='pose')|list|tojson }};

          // Check if there is data to plot
          if (aggregatedDurations.length > 0 && aggregatedDurations.some(duration => duration > 0)) {
              var ctx = document.getElementById('poseChart').getContext('2d');
              var poseChart = new Chart(ctx, {
                  type: 'bar',
                  data: {
                      labels: poseLabels,
                      datasets: [{
                          label: 'Duration (s)',
                          data: aggregatedDurations,
                          backgroundColor: [
                              'rgba(255, 99, 132, 0.2)',
                              'rgba(54, 162, 235, 0.2)'
                          ],
                          borderColor: [
                              'rgba(255, 99, 132, 1)',
                              'rgba(54, 162, 235, 1)'
                          ],
                          borderWidth: 1
                      }]
                  },
                  options: {
                      scales: {
                          y: {
                              beginAtZero: true
                          }
                      }
                  }
              });
          } else {
              // Optionally, hide the canvas or display a message if there are no detections
              document.getElementById('poseChart').style.display = 'none';
              // Or you could insert a message into the HTML
              var container = document.getElementById('poseChart').parentElement;
              var message = document.createElement('p');
              message.textContent = 'No pose detections to display.';
              container.appendChild(message);
          }
      });
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
          // Blink Chart
          var blinkData = {{ blink_data | tojson }};
          // Check if blinkData is not empty and contains non-zero average blink values
          if (blinkData.length > 0 && blinkData.some(data => data.average > 0)) {
              var ctxBlink = document.getElementById('blinkChart').getContext('2d');

              var timeLabels = blinkData.map(function(data) { return data.time; });
              var averageBlinks = blinkData.map(function(data) { return data.average; });

              var blinkChartData = {
                  labels: timeLabels,
                  datasets: [{
                      label: 'Average Blinks Per Minute',
                      data: averageBlinks,
                      fill: false,
                      borderColor: 'rgb(75, 192, 192)',
                      tension: 0.1
                  }]
              };

              new Chart(ctxBlink, {
                  type: 'line',
                  data: blinkChartData,
                  options: {
                      scales: {
                          y: {
                              beginAtZero: true
                          }
                      }
                  }
              });
          } else {
              // Hide the chart or display a message if there are no blink detections
              document.getElementById('blinkChart').style.display = 'none';
              // Optionally, show a message indicating no blink data is available
              var blinkContainer = document.getElementById('blinkChart').parentNode;
              var noDataMsg = document.createElement('p');
              noDataMsg.textContent = 'No blink data available.';
              blinkContainer.appendChild(noDataMsg);
          }
      });
    </script>

    <!-- {% for result in combined_results_sorted %}
                <div>
                    <strong>Timestamp:</strong> {{ result.timestamp }}<br>
                    <strong>Message:</strong> {{ result.message }}
                </div>
                <hr>
            {% endfor %} -->

    <!-- Optional JavaScript and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
