<!DOCTYPE html>
<!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Wed Mar 06 2024 08:17:20 GMT+0000 (Coordinated Universal Time) -->
<html
  data-wf-domain="elevate-7673d5.webflow.io"
  data-wf-page="65e71da996b7c2bba91db058"
  data-wf-site="65e71da996b7c2bba91db051"
>
  <head>
    <meta charset="utf-8" />
    <title>Elevate</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Webflow" name="generator" />
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <link
      href="https://assets-global.website-files.com/65e71da996b7c2bba91db051/css/elevate-7673d5.webflow.8c84457ac.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link
      href="https://fonts.gstatic.com"
      rel="preconnect"
      crossorigin="anonymous"
    />
    <script
      src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"
      type="text/javascript"
    ></script>
    <script type="text/javascript">
      WebFont.load({
        google: {
          families: [
            "Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic",
          ],
        },
      });
    </script>
    <script type="text/javascript">
      !(function (o, c) {
        var n = c.documentElement,
          t = " w-mod-";
        (n.className += t + "js"),
          ("ontouchstart" in o ||
            (o.DocumentTouch && c instanceof DocumentTouch)) &&
            (n.className += t + "touch");
      })(window, document);
    </script>
    <link
      href="https://assets-global.website-files.com/img/favicon.ico"
      rel="shortcut icon"
      type="image/x-icon"
    />
    <link
      href="https://assets-global.website-files.com/img/webclip.png"
      rel="apple-touch-icon"
    />
  </head>
  <body>
    <div class="navbar-no-shadow">
      <div
        data-animation="default"
        data-collapse="medium"
        data-duration="400"
        data-easing="ease"
        data-easing2="ease"
        role="banner"
        class="navbar-no-shadow-container w-nav"
      >
        <div class="container-regular">
          <div class="navbar-wrapper">
            <img
              src="https://assets-global.website-files.com/65e71da996b7c2bba91db051/65e726f155ae114a0d626457_Screenshot%20(151)-Photoroom.png-Photoroom.png"
              loading="lazy"
              width="74"
              alt=""
              class="image"
            />
            <ul role="list" class="nav-menu w-list-unstyled">
              <li><a href="home" class="nav-link">Home</a></li>
              <li><a href="aboutus" class="nav-link">About Us</a></li>
              <li><a href="features" class="nav-link">Features</a></li>
            </ul>
            {% if current_user.is_authenticated %}
            <span class="nav-link">Hello, {{ current_user.username }}</span>
            <a href="#" class="button w-button" id="logout-link">Logout</a>
          {% else %}
            <a href="{{ url_for('login') }}" class="button-2 w-button">Login</a>
            <a href="{{ url_for('signup') }}" class="button w-button">Signup</a>
          {% endif %}
            <div class="menu-button w-nav-button">
              <div class="w-icon-nav-menu"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <section class="combine-section_header6">
      <div class="combine-padding-global"></div>
    </section>
    <section class="testimonial-image-left">
      <div class="w-layout-blockcontainer container-9 w-container">
        <div class="w-layout-hflex flex-block">
            <div class="w-layout-blockcontainer container-7 w-container" style="height: auto; padding-top: 0px; padding-bottom: 0px; overflow: hidden;">
                <img src="{{ url_for('Elevate') }}" alt="Video Feed"  />
              </div>    
              
              <div class="w-layout-blockcontainer container-8 w-container" style="height: auto; padding-top: 10px; padding-bottom: 10px;">
                <p id="status" class="alert alert-primary" style="margin: 10px 0; text-align: center;">Recording Starting :</p>
                <p id="transcript" class="alert alert-secondary" style="display: none; margin: 10px 0; padding: 10px; text-align: justify;"> </p>
                <img
                id="transcriptImage"
                src="https://assets-global.website-files.com/65e71da996b7c2bba91db051/65e8259748a51382adfbe0a8_9c51192a-ce16-43d6-a581-a32c837dbbdd.webp"
                loading="lazy"
                style="max-width: 300px; width: 100%; height: auto; display: block;"
                alt="Speech Visualization"
              />
            </div>

              </div>
        </div>
      </div>
         
      <button id="toggleDisplayButton" class="button-3 w-button" style =  "padding: 10px ; margin-left: 30px">Toggle Display</button>
      <button id="stopDetectionButton" class="button-3 w-button" style =  "padding: 10px ; margin-left: 30px" >
        Stop Detection
      </button>
      <button id="toggleTranscriptButton" class="button-3 w-button"style =  "padding: 10px ; margin-left: 30px">Toggle Transcript</button>
     


    </section>

    <script>
        document.getElementById('toggleTranscriptButton').addEventListener('click', function() {
          var transcript = document.getElementById('transcript');
          var transcriptImage = document.getElementById('transcriptImage');
          
          // Check if the transcript is currently displayed.
          if (transcript.style.display === 'none') {
            // If the transcript is hidden, show it and hide the image.
            transcript.style.display = 'block';
            transcriptImage.style.display = 'none';
          } else {
            // If the transcript is shown, hide it and show the image.
            transcript.style.display = 'none';  
            transcriptImage.style.display = 'block';
          }
        });
      </script>

      <script>
        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute("content");
      
        document.getElementById('toggleDisplayButton').addEventListener('click', function() {
          fetch('/toggle_display', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': csrfToken, // Use the CSRF token obtained from the meta tag
            }
            // No need to send a body since we're just toggling a flag
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            console.log(data);
            // Optionally, update the UI based on the new state
          })
          .catch(error => console.error('Error toggling display:', error));
        });
      </script>
      

    <div
      id="postureReminder"
      style="
        display: none;
        position: fixed;
        top: 130px;
        right: 20px;
        background-color: lightblue;
        color: black;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      "
    >
      You have been in a bad posture for a while. Make sure to have a good
      posture !!! ðŸŒŸ
    </div>
    <div
      id="faceTouchReminder"
      style="
        display: none;
        position: fixed;
        top: 80px;
        right: 20px;
        background-color: lightcoral;
        color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      "
    >
      Remember not to touch your face too often. Stay healthy! ðŸ˜Š
    </div>

    <script>
      let speechResults = [];

      navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
        if (!MediaRecorder.isTypeSupported("audio/webm")) {
          return alert("Browser not supported");
        }
        const mediaRecorder = new MediaRecorder(stream, {
          mimeType: "audio/webm",
        });
        const socket = new WebSocket(
          "wss://api.deepgram.com/v1/listen?model=nova-2&filler_words=true&punctuate=true",
          ["token", "0b114c63c6ca5eca8669743b1aa7f6dede721660"]
        );
        socket.onopen = () => {
          document.querySelector("#status").textContent = "Recording Started : ";
          mediaRecorder.addEventListener("dataavailable", async (event) => {
            if (event.data.size > 0 && socket.readyState === 1) {
              socket.send(event.data);
            }
          });
          mediaRecorder.start(1000);
        };

        socket.onmessage = (message) => {
          const received = JSON.parse(message.data);
          const transcript = received.channel.alternatives[0].transcript;
          if (transcript && received.is_final) {
            console.log(transcript); // Log the transcript to the console
            document.querySelector("#transcript").textContent +=
              transcript + " ";

            // Prepare the result with a timestamp
            const timestamp = new Date();
            const result = {
              timestamp: timestamp.toISOString(),
              transcript: transcript,
            };

            // Send the result immediately
            fetch("/process_speech_results", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": document
                  .querySelector('meta[name="csrf-token"]')
                  .getAttribute("content"), // Use CSRF token from meta tag
              },
              body: JSON.stringify([result]), // Send result as an array
            })
              .then((response) => response.json())
              .then((data) => console.log("Server response:", data))
              .catch((error) => console.error("Error:", error));
          }
        };

        socket.onclose = () => console.log({ event: "onclose" });
        socket.onerror = (error) => console.log({ event: "onerror", error });
      });
    </script>





    <script>
      const csrf_token = document
        .querySelector('meta[name="csrf-token"]')
        .getAttribute("content");

      document
        .getElementById("stopDetectionButton")
        .addEventListener("click", function () {
          console.log("Stop detection button clicked");
          fetch("/stop_detection", {
            method: "POST",
            headers: {
              // If you're not sending JSON data, you might not need 'Content-Type': 'application/json',
              // especially if your Flask route handles form data.
              // 'Content-Type': 'application/json',
              "X-CSRFToken": csrf_token,
            },
            // If CSRF protection is enabled for AJAX requests, ensure the CSRF token is sent correctly.
            // For non-JSON requests, the CSRF token might need to be sent differently.
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
              if (data.success) {
                // Assuming you have a route '/display_results' that handles the display of combined results
                window.location.href = "/progress";
              } else {
                console.error("Error stopping detection");
              }
            })
            .catch((error) => console.error("Error:", error));
        });

      document
        .getElementById("sendResultsButton")
        .addEventListener("click", function () {
          if (speechResults.length > 0) {
            fetch("/process_speech_results", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrf_token, // Ensure CSRF token is included if required by your backend
              },
              body: JSON.stringify(speechResults),
            })
              .then((response) => response.json())
              .then((data) => {
                console.log("Server response:", data);
                // Handle response data from the server
              })
              .catch((error) => console.error("Error:", error));
          } else {
            console.log("No speech results to send.");
          }
        });
    </script>

    <script>
      setInterval(function () {
        fetch("/check_bad_posture")
          .then((response) => response.json())
          .then((data) => {
            const reminder = document.getElementById("postureReminder");
            if (data.isBadPosture) {
              reminder.style.display = "block"; // Show the reminder
            } else {
              reminder.style.display = "none"; // Hide the reminder
            }
          })
          .catch((error) => console.error("Error:", error));
      }, 5000); // Check every 5 seconds
    </script>

    <script>
      setInterval(function () {
        fetch("/check_face_touching")
          .then((response) => response.json())
          .then((data) => {
            const reminder = document.getElementById("faceTouchReminder");
            if (data.isTouchingFace) {
              reminder.style.display = "block"; // Show the reminder
            } else {
              reminder.style.display = "none"; // Hide the reminder
            }
          })
          .catch((error) => console.error("Error:", error));
      }, 5000); // Check every 5 seconds
    </script>


  </body>
</html>
